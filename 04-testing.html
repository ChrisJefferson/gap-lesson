<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Programming with GAP</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">Programming with GAP</h1></a>
          <h2 class="subtitle">Using regression tests</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="learning-objectives"><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Be able to create and run test files</li>
<li>Understand how test discrepancies and runtime regressions could be identified and interpreted</li>
<li>Understand how to adjust tests to check randomised algorithms</li>
<li>Learn the “Make it right, then make it fast” concept</li>
</ul>
</div>
</section>
<p>The code of <code>AvgOrdOfGroup</code> is very simple and possibly nothing could go wrong with it. It avoids problems with running out of memory because of iterating over the group instead of creating a list of its elements (calling <code>AsList(SymmetricGroup(11))</code> already results in exceeding the permitted memory), however it takes several minutes to calculate an average order of an element of <code>SymmetricGroup(11)</code>. But at least we are confident that it is correct.</p>
<p>Now we would like to write a better version of this function using some theoretical facts we know from the Group Theory. We may put <code>avgorg.g</code> under version control to revert changes if need be; we may create a new function to keep the old one around and compare the results of both; but this could be made even more efficient if we will use <strong>regression testing</strong>: this is the term for the testing based on rerunning previously completed tests to check that new changes do not impact their correctness or worsen their performance.</p>
<p>To start with, we need to create a <strong>test file</strong>. The test file looks exactly like the GAP session, so it is easy to create it by copying and pasting the GAP session with all GAP prompts, inputs and outputs into a text file (a test file could be also created from the log file with a GAP session recorded with the help of <code>LogTo</code>). During the test, GAP will run all inputs from the test, compare the outputs with those in the test file and will report any differences.</p>
<p>GAP test files are just text files, but the common practice is to name them with the extension <code>.tst</code>. Now create in the current directory (to avoid typing the full path), the file <code>avgord.tst</code> with the following content:</p>
<pre class="gap"><code># tests for average order of a group element

# permutation Group
gap&gt; S:=SymmetricGroup(9);
Sym( [ 1 .. 9 ] )
gap&gt; AvgOrdOfGroup(S);
3291487/362880</code></pre>
<p>As you see, the test file may include comments, with certain rules specifying where they may be placed, because one should be able to distinguish comments in the test file from GAP output started with <code>#</code>. For that purpose, lines at the beginning of the test file that start with <code>#</code>“, and one empty line together with one or more lines starting with <code>#</code> are considered as comments. All other lines are considered as GAP output from the preceding GAP input.</p>
<p>To run the test, one should use the function <code>Test</code>, as documented <a href="http://www.gap-system.org/Manuals/doc/ref/chap7.html#X87712F9D8732193C">here</a>. For example (assuming that the function <code>AvgOrdOfGroup</code> is already loaded):</p>
<pre class="gap"><code>Test(&quot;avgord.tst&quot;);</code></pre>
<pre class="output"><code>true</code></pre>
<p>In this case, <code>Test</code> reported no discrepancies and returned <code>true</code>, so we conclude that the test has passed.</p>
<p>We will not cover a topic of writing a good and comprehensive test suite here, and also will not cover various options of the <code>Test</code> function, permitting, for example, to ignore differences in the output formatting, or to display progress of the test, as these are described in its documentation.</p>
<p>Instead, we will now add more groups to <code>avgord.tst</code>, to demonstrate that the code also works with other kinds of groups, and to show various ways of combining commands in the test file:</p>
<pre class="gap"><code># tests for average order of a group element

# permutation group
gap&gt; S:=SymmetricGroup(9);
Sym( [ 1 .. 9 ] )
gap&gt; AvgOrdOfGroup(S);
3291487/362880

# pc group
gap&gt; D:=DihedralGroup(512);
&lt;pc group of size 512 with 9 generators&gt;
gap&gt; AvgOrdOfGroup(D);
44203/512
gap&gt; G:=TrivialGroup();; # suppress output
gap&gt; AvgOrdOfGroup(G);
1

# fp group
gap&gt; F:=FreeGroup(&quot;a&quot;,&quot;b&quot;);
&lt;free group on the generators [ a, b ]&gt;
gap&gt; G:=F/ParseRelators(GeneratorsOfGroup(F),&quot;a^8=b^2=1, b^-1ab=a^-1&quot;);
&lt;fp group on the generators [ a, b ]&gt;
gap&gt; AvgOrdOfGroup(G);
59/16

# finite matrix group over integers

# matrix group over a finite field
gap&gt; AvgOrdOfGroup(SL(2,5));
221/40</code></pre>
<p>Let us test the extended version of the test again and check that it works:</p>
<pre class="gap"><code>Test(&quot;avgord.tst&quot;);</code></pre>
<pre class="output"><code>true</code></pre>
<p>Now we will work on a better implementation. Of course, the order of an element is an invariant of a conjugacy class of elements of a group, so we need only to know the orders of conjugacy classes of elements and their representatives. The following code, being added into <code>avgord.g</code>, reads into GAP and returns the answer without going into an error</p>
<pre class="gap"><code>AvgOrdOfGroup := function(G)
local cc, sum, c;
cc:=ConjugacyClasses(G);
sum:=0;
for c in cc do
  sum := sum + Order( Representative(c) ) * Size(cc);
od;
return sum/Size(G);
end;</code></pre>
<p>but when we run the test, here comes a surprise!</p>
<pre class="gap"><code>Read(&quot;avgord.g&quot;);
Test(&quot;avgord.tst&quot;);</code></pre>
<pre class="output"><code>########&gt; Diff in avgord.tst, line 6:
# Input is:
AvgOrdOfGroup(S);
# Expected output:
3291487/362880
# But found:
11/672
########
########&gt; Diff in avgord.tst, line 12:
# Input is:
AvgOrdOfGroup(D);
# Expected output:
44203/512
# But found:
2862481/512
########
########&gt; Diff in avgord.tst, line 23:
# Input is:
AvgOrdOfGroup(G);
# Expected output:
59/16
# But found:
189/16
########
########&gt; Diff in avgord.tst, line 29:
# Input is:
AvgOrdOfGroup(SL(2,5));
# Expected output:
221/40
# But found:
69/20
########
false</code></pre>
<p>Indeed, we made (deliberately) a typo and replaced <code>Size(c)</code> by <code>Size(cc)</code>. The correct version of course should look as follows:</p>
<pre class="gap"><code>AvgOrdOfGroup := function(G)
local cc, sum, c;
cc:=ConjugacyClasses(G);
sum:=0;
for c in cc do
  sum := sum + Order( Representative(c) ) * Size(c);
od;
return sum/Size(G);
end;</code></pre>
<p>Now we will fix this in <code>avgord.g</code>, and read and test it again to check that the tests run correctly.</p>
<pre class="gap"><code>Read(&quot;avgord.g&quot;);
Test(&quot;avgord.tst&quot;);</code></pre>
<pre class="output"><code>true</code></pre>
<p>Thus, the approach “Make it right, then make it fast” helped to detect a bug immediately after it has been introduced.</p>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/alex-konovalov/gap-lesson">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
