<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Programming with GAP</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">Programming with GAP</h1></a>
          <h2 class="subtitle">Small groups search</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="learning-objectives"><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Using Small Groups Library</li>
<li>Designing a system of functions to fit together</li>
</ul>
</div>
</section>
<p>In this section, we are interested to discover some non-trivial groups having the property that the average order of their elements is an integer.</p>
<p>GAP distribution includes a number of data libraries (see an overview <a href="http://www.gap-system.org/Datalib/datalib.html">here</a>). One of them is the <a href="http://www.gap-system.org/Packages/sgl.html">Small Groups Library</a> by Hans Ulrich Besche, Bettina Eick and Eamonn O’Brien.</p>
<p>This library provides various utilities to determine which information is stored there and submit queries to search for groups with desired properties. The key functions are <code>SmallGroup</code>, <code>AllSmallGroups</code>, <code>NrSmallGroups</code>, <code>SmallGroupsInformation</code> and <code>IdGroup</code>. For example:</p>
<pre class="gap"><code>gap&gt; NrSmallGroups(64);
267
gap&gt; SmallGroupsInformation(64);

  There are 267 groups of order 64.
  They are sorted by their ranks.
     1 is cyclic.
     2 - 54 have rank 2.
     55 - 191 have rank 3.
     192 - 259 have rank 4.
     260 - 266 have rank 5.
     267 is elementary abelian.

  For the selection functions the values of the following attributes
  are precomputed and stored:
     IsAbelian, PClassPGroup, RankPGroup, FrattinifactorSize and
     FrattinifactorId.

  This size belongs to layer 2 of the SmallGroups library.
  IdSmallGroup is available for this size.

gap&gt; G:=SmallGroup(64,2);
&lt;pc group of size 64 with 6 generators&gt;
gap&gt; AllSmallGroups(Size,64,NilpotencyClassOfGroup,5);
[ &lt;pc group of size 64 with 6 generators&gt;, &lt;pc group of size 64 with 6 generators&gt;,
  &lt;pc group of size 64 with 6 generators&gt; ]
gap&gt; List(last,IdGroup);
[ [ 64, 52 ], [ 64, 53 ], [ 64, 54 ] ]</code></pre>
<p>We would like to use our own testing function, which we will create here, using inline notation (available for one-argument functions):</p>
<pre class="gap"><code>TestOneGroup := G -&gt; IsInt( AvgOrdOfGroup(G) );</code></pre>
<p>Now try, for example</p>
<pre class="gap"><code>List([TrivialGroup(),Group((1,2))],TestOneGroup);</code></pre>
<pre class="output"><code>[ true, false ]</code></pre>
<pre class="gap"><code>gap&gt; AllSmallGroups(Size,24,TestOneGroup,true);</code></pre>
<pre class="output"><code>[ ]</code></pre>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2 id="modular-programming-begins-here"><span class="glyphicon glyphicon-pushpin"></span>Modular programming begins here</h2>
</div>
<div class="panel-body">
<p>Why a good design decision is for such function to return booleans, and not just print information or return a string like <code>&quot;YES&quot;</code>?</p>
</div>
</aside>
<p>This is a simple example of a function which tests all groups of a given order. It creates one group at a time, checks the desired property, and returns as soon as an example is discovered. Otherwise it returns <code>fail</code> which is a special kind of boolean variable in GAP.</p>
<pre class="gap"><code>TestOneOrderEasy := function(n)
local i;
for i in [1..NrSmallGroups(n)] do
  if TestOneGroup( SmallGroup( n, i ) ) then
    return [n,i];
  fi;
od;
return fail;
end;</code></pre>
<p>For example,</p>
<pre class="gap"><code>TestOneOrderEasy(1);</code></pre>
<pre class="output"><code>[ 1, 1 ]</code></pre>
<pre class="gap"><code>TestOneOrderEasy(24);</code></pre>
<pre class="output"><code>fail</code></pre>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2 id="allsmallgroups-runs-out-of-memory---what-to-do"><span class="glyphicon glyphicon-pushpin"></span><code>AllSmallGroups</code> runs out of memory - what to do?</h2>
</div>
<div class="panel-body">
<ul>
<li>Use iteration over <code>[1..NrSmallGroups(n)]</code> as shown in the function above</li>
<li>Use <code>IdsOfAllSmallGroups</code> which accepts same arguments as <code>AllSmallGroups</code> but returns ids instead of groups.</li>
</ul>
</div>
</aside>
<p>Iterating over <code>[1..NrSmallGroups(n)]</code> gives you more flexibility if you need more control over the progress of calculation. For example, the next version of our testing function prints additional information about the number of the group being tested. It also supplies the testing function as an argument (why do you think this is better?).</p>
<pre class="gap"><code>TestOneOrder := function(f,n)
local i, G;
for i in [1..NrSmallGroups(n)] do
  Print(n, &quot;:&quot;, i, &quot;/&quot;, NrSmallGroups(n), &quot;\r&quot;);
  G := SmallGroup( n, i );
  if f(G) then
    Print(&quot;\n&quot;);
    return [n,i];
  fi;
od;
Print(&quot;\n&quot;);
return fail;
end;</code></pre>
<p>For example,</p>
<pre class="gap"><code>TestOneOrder(TestOneGroup,64);</code></pre>
<p>will display a changing counter during calculation and then return <code>fail</code>:</p>
<pre class="output"><code>64:267/267
fail</code></pre>
<p>The next step is to integrate <code>TestOneOrder</code> into a function which will test all orders from 2 to <code>n</code> and stop as soon as it will find an example of a group with the average order of an element being an integer:</p>
<pre class="gap"><code>TestAllOrders:=function(f,n)
local i, res;
for i in [2..n] do
  res:=TestOneOrder(f,i);
  if res &lt;&gt; fail then
    return res;
  fi;
od;
return fail;
end;</code></pre>
<p>It reports that there is such group of order 105:</p>
<pre class="gap"><code>TestAllOrders(TestOneGroup,128);</code></pre>
<pre class="output"><code>2:1/1
3:1/1
4:2/2
5:1/1
6:2/2
7:1/1
8:5/5
...
...
...
100:16/16
101:1/1
102:4/4
103:1/1
104:14/14
105:1/2
[ 105, 1 ]</code></pre>
<p>To explore it further, we can get its <code>StructureDescription</code> (see <a href="http://www.gap-system.org/Manuals/doc/ref/chap39.html#X87BF1B887C91CA2E">here</a> for the explanation of the notation it uses):</p>
<pre class="gap"><code>G:=SmallGroup(105,1); AvgOrdOfGroup(G); StructureDescription(G);</code></pre>
<pre class="output"><code>&lt;pc group of size 105 with 3 generators&gt;
17
&quot;C5 x (C7 : C3)&quot;</code></pre>
<p>and then convert it to a finitely presented group to see its generators and relators:</p>
<pre class="gap"><code>H:=SimplifiedFpGroup(Image(IsomorphismFpGroup(G)));
RelatorsOfFpGroup(H);</code></pre>
<pre class="output"><code>&lt;fp group on the generators [ F1, F2, F3 ]&gt;
[ F1^3, F2^-1*F1^-1*F2*F1, F3^-1*F2^-1*F3*F2, F3^-1*F1^-1*F3*F1*F3^-1, F2^5,
  F3^7 ]</code></pre>
<p>Now we want to try larger groups, starting from the order 106 (we check that the other group of order 105 possesses no such property)</p>
<pre class="gap"><code>List(AllSmallGroups(105),AvgOrdOfGroup);</code></pre>
<pre class="output"><code>[ 17, 301/5 ]</code></pre>
<p>With a little modification, we add an extra argument specifying the order from which to start:</p>
<pre class="gap"><code>TestRangeOfOrders:=function(f,n1,n2)
local n, res;
for n in [n1..n2] do
  res:=TestOneOrder(f,n);
  if res &lt;&gt; fail then
    return res;
  fi;
od;
return fail;
end;</code></pre>
<p>But now we call it with</p>
<pre class="gap"><code>TestRangeOfOrders(TestOneGroup,106,256);</code></pre>
<p>and discover that testing 2328 groups of order 128 and moreover 56092 groups of order 256 is already too long.</p>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2 id="dont-panic"><span class="glyphicon glyphicon-pushpin"></span>Don’t panic!</h2>
</div>
<div class="panel-body">
<p>You can interrupt GAP by pressing Ctrl-C once. After that, GAP will enter a break loop, designated by the break prompt <code>brk</code>. You can leave it by typing <code>quit;</code> (beware of pressing Ctrl-C twice within a second - that will terminate GAP session completely).</p>
</div>
</aside>
<p>This is again the situation where theoretical knowledge helps much more than brute-force approach. If the group is a <em>p</em>-group, then the order of each conjugacy class of a non-identity element of a group is divisible by <em>p</em>, therefore, the average order of a group element can not be an integer. Therefore, <em>p</em>-groups could be excluded from calculation. So, the new version of the code is</p>
<pre class="gap"><code>TestRangeOfOrders:=function(f,n1,n2)
local n, res;
for n in [n1..n2] do
  if not IsPrimePowerInt(n) then
     res:=TestOneOrder(f,n);
     if res &lt;&gt; fail then
       return res;
     fi;
   fi;
od;
return fail;
end;</code></pre>
<p>and using it we are able to discover a group of order 357 with the same property:</p>
<pre class="gap"><code>gap&gt; TestRangeOfOrders(TestOneGroup,106,512);</code></pre>
<pre class="output"><code>106:2/2
108:45/45
...
350:10/10
351:14/14
352:195/195
354:4/4
355:2/2
356:5/5
357:1/2
[ 357, 1 ]</code></pre>
<p>The next function shows even further flexibility: it is variadic, i.e. it may accept arbitrary number of arguments that will be available as the list <code>arg</code> (special name for this kind of situation, don’t use it otherwise). It also introduces Info messages that may be displayed or not dependently on the corresponding Info level:</p>
<pre class="gap"><code>InfoSmallGroupsSearch := NewInfoClass(&quot;InfoSmallGroupsSearch&quot;);

TestOneOrderVariadic := function(arg)
local f, n, n1, n2, i;

if not Length(arg) in [2..4] then
  Error(&quot;The number of arguments must be 2,3 or 4\n&quot; );
fi;

if not IsFunction( arg[1] ) then
  Error(&quot;The first argument must be a function\n&quot; );
else
  f := arg[1];
fi;

if not IsPosInt( arg[2] ) then
  Error(&quot;The second argument must be a positive integer\n&quot; );
else
  n := arg[2];
fi;

if IsBound(arg[3]) then
  n1:=arg[3];
  if not n1 in [1..NrSmallGroups(n)] then
    Error(&quot;The 3rd argument must belong to &quot;, [1..NrSmallGroups(n)], &quot;\n&quot; );
  fi;
else
  n1:=1;
fi;

if IsBound(arg[4]) then
  n2:=arg[4];
  if not n2 in [1..NrSmallGroups(n)] then
    Error(&quot;The 4th argument must belong to &quot;, [1..NrSmallGroups(n)], &quot;\n&quot; );
  elif n2 &lt; n1 then
    Error(&quot;The 4th argument must be greater or equal to the 3rd \n&quot; );
  fi;
else
  n2:=NrSmallGroups(n);
fi;

Info( InfoSmallGroupsSearch, 1,
      &quot;Checking groups &quot;, n1, &quot; ... &quot;, n2, &quot; of order &quot;, n );
for i in [n1..n2] do
  if InfoLevel( InfoSmallGroupsSearch ) &gt; 1 then
    Print(i, &quot;/&quot;, NrSmallGroups(n), &quot;\r&quot;);
  fi;
  if f(SmallGroup(n,i)) then
    Info( InfoSmallGroupsSearch, 1,
          &quot;Discovered counterexample: SmallGroup( &quot;, n, &quot;, &quot;, i, &quot; )&quot; );
    return [n,i];
  fi;
od;
Info( InfoSmallGroupsSearch, 1,
      &quot;Search completed - no counterexample discovered&quot; );
return fail;
end;</code></pre>
<p>Because now the test output may not be reproducible at some other Info levels, we would like to ensure that we remember the value of the Info level before the test and restore it after the test:</p>
<pre class="gap"><code># Finding groups with integer average order
gap&gt; INFO_SSS:=InfoLevel(InfoSmallGroupsSearch);;
gap&gt; res:=[];;
gap&gt; for n in [1..360] do
&gt;      if not IsPrimePowerInt(n) then
&gt;        t := TestOneOrderVariadic( IsIntegerAverageOrder,n,1,NrSmallGroups(n) );
&gt;        if t &lt;&gt; fail then
&gt;          Add(res,t);
&gt;        fi;
&gt;      fi;
&gt;    od;
gap&gt; res;
[ [ 1, 1 ], [ 105, 1 ], [ 357, 1 ] ]
gap&gt; SetInfoLevel( InfoSmallGroupsSearch, INFO_SSS);</code></pre>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="does-the-small-groups-library-contain-another-group-with-this-property"><span class="glyphicon glyphicon-pencil"></span>Does the Small Groups Library contain another group with this property?</h2>
</div>
<div class="panel-body">
<ul>
<li><p>What can you say about the order of the groups with this property?</p></li>
<li><p>Can you estimate how long it may take to check all 408641062 groups of order 1536 ?</p></li>
<li><p>How many groups you need to check, excluding p-groups and those of order 1536?</p></li>
<li><p>Can you find another group (of order not equal to 1536) with this property containing in the Small Groups Library?</p></li>
</ul>
</div>
</section>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/alex-konovalov/gap-lesson">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
