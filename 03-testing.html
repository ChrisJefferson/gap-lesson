<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Make it right, then make it fast</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">Make it right, then make it fast</h1></a>
          <h2 class="subtitle">Using tests</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="learning-objectives"><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Create test files</li>
</ul>
</div>
</section>
<p>The code of <code>AvgOrdOfGroup</code> is very simple and possibly nothing could go wrong with it. It avoids problems with running out of memory because of iterating over the group instead of creating a list of its elements (calling <code>AsList(SymmetricGroup(11))</code> already results in exceeding the permitted memory), however it takes several minutes to calculate an average order of an element of <code>SymmetricGroup(11)</code>. But at least we are confident that it is correct.</p>
<p>Now we would like to write a better version of this function using some theoretical facts we know from the Group Theory. We may put <code>avgorg.g</code> under version control to revert changes if need be; we may create a new function to keep the old one around and compare the results of both; but this could be made even more efficient if we will use <strong>regression tests</strong>.</p>
<p>To start with, we need to create a test file. We will copy and paste the GAP session with GAP prompts, inputs and outputs into a text file, called <code>avgord.tst</code> and created in the current directory (to avoid typing full path).</p>
<pre class="gap"><code># tests for average order of a group element

# permutation Group
gap&gt; S:=SymmetricGroup(9);
Sym( [ 1 .. 9 ] )
gap&gt; AvgOrdOfGroup(S);
3291487/362880</code></pre>
<p>Test files may be tested using the function <code>Test</code>, as documented <a href="http://www.gap-system.org/Manuals/doc/ref/chap7.html#X87712F9D8732193C">here</a>. As you may see above, they may include comments, with certain rules specifying where they may be placed.</p>
<p>Now we will run the test, assuming that the function <code>AvgOrdOfGroup</code> is already loaded. This test works correctly, so <code>Test</code> reports no discrepancies and returns <code>true</code>:</p>
<pre class="gap"><code>Test(&quot;avgord.tst&quot;);</code></pre>
<pre class="output"><code>true</code></pre>
<p>We will not cover a topic of writing a good and comprehensive test suite here, but at least we will add groups of some other kinds to demonstrate them, as well as several variations of combining commands in the test file:</p>
<pre class="gap"><code># tests for average order of a group element

# permutation group
gap&gt; S:=SymmetricGroup(9);
Sym( [ 1 .. 9 ] )
gap&gt; AvgOrdOfGroup(S);
3291487/362880

# pc group
gap&gt; D:=DihedralGroup(512);
&lt;pc group of size 512 with 9 generators&gt;
gap&gt; AvgOrdOfGroup(D);
44203/512
gap&gt; G:=TrivialGroup();; # suppress output
gap&gt; AvgOrdOfGroup(G);
1

# fp group
gap&gt; F:=FreeGroup(&quot;a&quot;,&quot;b&quot;);
&lt;free group on the generators [ a, b ]&gt;
gap&gt; G:=F/ParseRelators(GeneratorsOfGroup(F),&quot;a^8=b^2=1, b^-1ab=a^-1&quot;);
&lt;fp group on the generators [ a, b ]&gt;
gap&gt; AvgOrdOfGroup(G);
59/16

# finite matrix group over integers

# matrix group over a finite field
gap&gt; AvgOrdOfGroup(SL(2,5));
221/40</code></pre>
<p>Let us test the extended version of the test again and check that it works:</p>
<pre class="gap"><code>Test(&quot;avgord.tst&quot;);</code></pre>
<pre class="output"><code>true</code></pre>
<p>Now we will present a better implementation. Of course, the order of an element is an invariant of a conjugacy class of elements of a group, so we need only to know the orders of conjugacy classes of elements and their representatives:</p>
<pre class="gap"><code>AvgOrdOfGroup := function(G)
local cc, sum, c;
cc:=ConjugacyClasses(G);
sum:=0;
for c in cc do
  sum := sum + Order( Representative(c) ) * Size(c);
od;
return sum/Size(G);
end;</code></pre>
<p>Now edit the file <code>avgord.g</code> and modify <code>AvgOrdOfGroup</code> to use the new algorithm. Load the new version into GAP and call <code>Test(&quot;avgord.tst&quot;);</code> again to check that the tests run correctly.</p>
<p>What would happen if the calculation is wrong? Edit <code>avgorg.g</code> and introduce a typo, replacing <code>Size(c)</code> by <code>Size(cc)</code>, then save the file, reread it and repeat the test:</p>
<pre class="gap"><code>Read(&quot;avgord.g&quot;);
Test(&quot;avgord.tst&quot;);</code></pre>
<pre class="output"><code>########&gt; Diff in avgord.tst, line 6:
# Input is:
AvgOrdOfGroup(S);
# Expected output:
3291487/362880
# But found:
11/672
########
########&gt; Diff in avgord.tst, line 12:
# Input is:
AvgOrdOfGroup(D);
# Expected output:
44203/512
# But found:
2862481/512
########
########&gt; Diff in avgord.tst, line 23:
# Input is:
AvgOrdOfGroup(G);
# Expected output:
59/16
# But found:
189/16
########
########&gt; Diff in avgord.tst, line 29:
# Input is:
AvgOrdOfGroup(SL(2,5));
# Expected output:
221/40
# But found:
69/20
########
false</code></pre>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
