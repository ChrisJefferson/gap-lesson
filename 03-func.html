<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Programming with GAP</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">Programming with GAP</h1></a>
          <h2 class="subtitle">Functions in GAP</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="learning-objectives"><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Using command line for prototyping</li>
<li>Creating functions</li>
<li>Reading GAP code from a file</li>
</ul>
</div>
</section>
<p>Just to remind our task: for a finite group <span class="math inline"><em>G</em></span>, we would like to calculate the average order of its elements (that is, the sum of orders of its elements divided by the order of the group).</p>
<p>We begin with a very straightforward approach, iterating over all elements of the group in question:</p>
<pre class="gap"><code>S:=SymmetricGroup(10);</code></pre>
<pre class="output"><code>Sym( [ 1 .. 10 ] )</code></pre>
<pre class="gap"><code>sum:=0;</code></pre>
<pre class="output"><code>0</code></pre>
<pre class="gap"><code>for g in S do
  sum := sum + Order(g);
od;
sum/Size(S);</code></pre>
<pre class="output"><code>39020911/3628800</code></pre>
<p>Now assume that we would like to save this fragment of the GAP code and later repeat this calculation for some other groups. We may even reformat it to fit it into one line and use double semicolon to suppress the output of <code>sum</code>:</p>
<pre class="gap"><code>sum:=0;; for g in S do sum := sum + Order(g); od; sum/Size(S);</code></pre>
<pre class="output"><code>39020911/3628800</code></pre>
<p>Now we may easily copy and paste it into the GAP session when we will need it next time. But here we see the first inconvenience: the code expects that the group in question must be stored in a variable named <code>S</code>, so either we can have only with one group <code>S</code> at a time, or we need to edit the code:</p>
<pre class="gap"><code>S:=AlternatingGroup(10);</code></pre>
<pre class="output"><code>Alt( [ 1 .. 10 ] )</code></pre>
<pre class="gap"><code>sum:=0;; for g in S do sum := sum + Order(g); od; sum/Size(S);</code></pre>
<pre class="output"><code>2587393/259200</code></pre>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2 id="this-works-only-for-rapid-prototyping"><span class="glyphicon glyphicon-pushpin"></span>This works only for rapid prototyping</h2>
</div>
<div class="panel-body">
<ul>
<li>incidentally, one could copy and paste only a part of the code, and incomplete input may trigger a break loop;</li>
<li>even more dangerous: one could forget to reset <code>sum</code> to zero prior to the new calculation and obtain incorrect results;</li>
<li>the group in question may have a different variable name, so the code will have to be changed; <strong>last, but not least:</strong> when GAP code is pasted into the interpreter, it is evaluated line by line. If you have a long file with many commands, and the syntax error is in the line N, this error will be reported only when GAP will complete the evaluation of all preceding lines, and that might be quite time-consuming.</li>
</ul>
</div>
</aside>
<p>That is why we need to give the GAP code more structure by organising it into functions:</p>
<ul>
<li>functions are parsed first and may be called later;</li>
<li>any <strong>syntax</strong> errors will be detected in the parsing stage, and not at the time of the call;</li>
<li>functions may have local variables, and this prevents them being accidentally overwritten just because of reusing the same name of the variable to store something else.</li>
</ul>
<p>The following function takes an argument <code>S</code> and computes the average order of its elements:</p>
<pre class="gap"><code>AvgOrdOfGroup := function(G)
local sum, g;
sum := 0;
for g in G do
  sum := sum + Order(g);
od;
return sum/Size(G);
end;</code></pre>
<pre class="output"><code>function( S ) ... end</code></pre>
<p>Now we can apply it to another group, passing the group as an argument:</p>
<pre class="gap"><code>A:=AlternatingGroup(10); AvgOrdOfGroup(A); time;</code></pre>
<pre class="output"><code>Alt( [ 1 .. 10 ] )
2587393/259200
837</code></pre>
<p>The example above also demonstrates <code>time</code> - this is the variable which stores the CPU time in milliseconds spent by the last command.</p>
<p>Thus, now we may create new groups and reuse <code>AvgOrdOfGroup</code> to calculate average order of their elements in the same GAP session. Our next goal is to make it reusable for the future calculations.</p>
<p>Using a text editor (for example, the one that you have used for the previous Software Carpentry lessons), create a text file called <code>avgord.g</code> containing the code of the function and comments (a good practice to use them!):</p>
<pre class="gap"><code>#####################################################################
#
# AvgOrdOfGroup(G)
#
# Calculating the average order of an element of G, where G meant to
# be a group but in fact may be any collection of objects having
# multiplicative order
#
AvgOrdOfGroup := function(G)
local sum, g;
sum := 0;
for g in G do
  sum := sum + Order(g);
od;
return sum/Size(G);
end;</code></pre>
<p>Now start a new GAP session and create another group, for example <span class="math inline"><em>M</em><sub>11</sub></span>:</p>
<pre class="gap"><code>M11:=MathieuGroup(11);</code></pre>
<pre class="output"><code>Group([ (1,2,3,4,5,6,7,8,9,10,11), (3,7,11,8)(4,10,5,6) ])</code></pre>
<p>Clearly, <code>AvgOrdOfGroup</code> is not defined in this session, so an attempt to call this function results in an error:</p>
<pre class="gap"><code>AvgOrdOfGroup(M11);</code></pre>
<pre class="error"><code>Error, Variable: &#39;AvgOrdOfGroup&#39; must have a value
not in any function at line 2 of *stdin*</code></pre>
<p>To be available, first it should be loaded using the function <code>Read</code>. Below we assume that the file is in the current directory, so no path is needed).</p>
<pre class="gap"><code>Read(&quot;avgord.g&quot;);</code></pre>
<p>This loads the file into GAP, and the function <code>AvgOrdOfGroup</code> is now available:</p>
<pre class="gap"><code>AvgOrdOfGroup(M11);</code></pre>
<pre class="output"><code>53131/7920</code></pre>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2 id="which-function-is-faster"><span class="glyphicon glyphicon-pushpin"></span>Which function is faster?</h2>
</div>
<div class="panel-body">
<p>Try to repeatedly calculate <code>AvgOrdOfGroup(M11)</code> and <code>AvgOrdOfCollection(M11)</code> and compare runtimes. Do this for new copy of <code>M11</code> and for the one for which this parameter has already been observed. What do you observe?</p>
</div>
</aside>
<p>In the example of using <code>Read</code>, new GAP session was started to make it clear that <code>AvgOrdOfGroup</code> did not exist before the call of <code>Read</code> and was loaded from the file. However, a file with a function like this could be read multiple times in the same GAP session (later you will see cases when re-reading a file is more complicated). Calling <code>Read</code> again executes all code in the file being read. This means that if the code of the function has been modified, and it has no errors (but possibly has warnings), the function will be overwritten. <strong>Never ignore the warnings!</strong></p>
<p>For example, let us edit the file and replace the line</p>
<pre class="gap"><code>return sum/Size(G);</code></pre>
<p>by the line with a deliberate syntax error:</p>
<pre class="gap"><code>return Float(sum/Size(G);</code></pre>
<p>Now read this file with</p>
<pre class="gap"><code>Read(&quot;avgord.g&quot;);</code></pre>
<p>and you will see an error message:</p>
<pre class="error"><code>Syntax error: ) expected in avgord.g line 7
return Float(sum/Size(G);
                        ^</code></pre>
<p>In this case, the function remains the same:</p>
<pre class="gap"><code>Print(AvgOrdOfGroup);</code></pre>
<pre class="output"><code>function ( G )
    for g  in G  do
        sum := sum + Order( g );
    od;
    return sum / Size( G );
end</code></pre>
<p>Now correct the error by adding a missing closing bracket, read the file again and recalculate the average order of an element for <code>M11</code>:</p>
<pre class="gap"><code>Read(&quot;avgord.g&quot;);
AvgOrdOfGroup(M11);</code></pre>
<pre class="output"><code>6.70846</code></pre>
<p>Now letâ€™s see an example of a <em>warning</em>. Since it is only a warning, it will redefine the function, and this may cause some unexpected result. To see what could happen, first edit the file to rollback the change in the type of the result (so it will return a rational instead of a float), and then comment out two lines as follows:</p>
<pre class="gap"><code>AvgOrdOfGroup := function(G)
# local sum, g;
# sum := 0;
for g in G do
  sum := sum + Order(g);
od;
return sum/Size(G);
end;</code></pre>
<p>Now, when you read the file, you will see warnings:</p>
<pre class="gap"><code>Read(&quot;avgord.g&quot;);</code></pre>
<pre class="error"><code>Syntax error: warning: unbound global variable in avgord.g line 4
for g in G do
       ^
Syntax error: warning: unbound global variable in avgord.g line 5
  sum := sum + Order(g);
       ^
Syntax error: warning: unbound global variable in avgord.g line 5
  sum := sum + Order(g);
             ^
Syntax error: warning: unbound global variable in avgord.g line 7
return sum/Size(G);
          ^</code></pre>
<p>These warnings mean because <code>g</code> and <code>sum</code> are not declared as <code>local</code> variables, GAP will expect them to be global variables at the time when the function will be called. Because they did not exist when <code>Read</code> was called, a warning was displayed. However, if they would be existing by that time, there would be no warning, and they may be still overwritten during the call to <code>AvgOrdOfGroup</code>! This shows how important is to declare local variables. Let us investigate what happened in slightly more details:</p>
<p>The function is now re-defined, as we can see from its output (or can inspect with <code>PageSource(AvgOrdOfGroup)</code> which will also display comments, if any):</p>
<pre class="gap"><code>Print(AvgOrdOfGroup);</code></pre>
<pre class="output"><code>function ( G )
    for g in G  do
        sum := sum + Order( g );
    od;
    return sum / Size( G );
end</code></pre>
<p>but an attempt to run it results in an break loop:</p>
<pre class="gap"><code>AvgOrdOfGroup(M11);</code></pre>
<pre class="error"><code>Error, Variable: &#39;sum&#39; must have an assigned value in
  sum := sum + Order( g ); called from
&lt;function &quot;AvgOrdOfGroup&quot;&gt;( &lt;arguments&gt; )
 called from read-eval loop at line 24 of *stdin*
you can &#39;return;&#39; after assigning a value
brk&gt;</code></pre>
<p>from which you can exit by entering <code>quit;</code>.</p>
<p>What happens next demonstrates how things may go wrong:</p>
<pre class="gap"><code>sum:=2^64; g:=[1];</code></pre>
<pre class="output"><code>18446744073709551616
[ 1 ]</code></pre>
<pre class="gap"><code>AvgOrdOfGroup(M11);</code></pre>
<pre class="output"><code>18446744073709604747/7920</code></pre>
<pre class="gap"><code>sum; g;</code></pre>
<pre class="output"><code>18446744073709604747
(1,2)(3,10,5,6,8,9)(4,7,11)</code></pre>
<p>Now, before reading the next part of the lesson, please revert the last change by uncommenting the two commented lines, so that you have initial version of <code>AvgOrdOfGroup</code> in the file <code>avgord.g</code> again:</p>
<pre class="gap"><code>AvgOrdOfGroup := function(G)
local sum, g;
sum := 0;
for g in G do
  sum := sum + Order(g);
od;
return sum/Size(G);
end;</code></pre>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="paths"><span class="glyphicon glyphicon-pencil"></span>Paths</h2>
</div>
<div class="panel-body">
<p>How to specify paths to files in all operating systems and where to find your home and current directory.</p>
</div>
</section>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
